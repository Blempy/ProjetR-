{% extends "base.html" %}

{% block title %}Nouvelle fiche tâche{% endblock %}

{% block content %}
<section class="card">
  <h2>Nouvelle fiche tâche</h2>
  <p>Les champs multi-lignes acceptent une entrée par ligne. Le formulaire génère un fichier Markdown dans <code>refs/fiches_taches/</code>.</p>

  <form method="post" class="form-grid">
    <div class="field">
      <label for="phase">Phase MOE</label>
      <input type="text" id="phase" name="phase" list="phase-list" required value="{{ form.get('phase') if form else '' }}">
      <datalist id="phase-list">
        {% for phase in phase_options %}
          <option value="{{ phase }}">
        {% endfor %}
      </datalist>
    </div>

    <div class="field">
      <label for="task_name">Intitulé de la tâche</label>
      <input type="text" id="task_name" name="task_name" required value="{{ form.get('task_name') if form else '' }}">
    </div>

    <div class="field">
      <label for="responsable">Responsable / intervenants</label>
      <input type="text" id="responsable" name="responsable" value="{{ form.get('responsable') if form else '' }}">
    </div>

    <div class="field">
      <label for="frequency">Fréquence</label>
      <input type="text" id="frequency" name="frequency" placeholder="Ex : À chaque projet" value="{{ form.get('frequency') if form else '' }}">
    </div>

    <div class="field">
      <label for="duration">Durée estimée (sans automatisation)</label>
      <input type="text" id="duration" name="duration" value="{{ form.get('duration') if form else '' }}">
    </div>

    <div class="field full">
      <label for="objective">Objectif principal</label>
      <textarea id="objective" name="objective" rows="2" required>{{ form.get('objective') if form else '' }}</textarea>
    </div>

    <div class="field">
      <label for="trigger">Déclencheur</label>
      <input type="text" id="trigger" name="trigger" value="{{ form.get('trigger') if form else '' }}">
    </div>

    <div class="field full">
      <label for="steps">Étapes principales</label>
      <textarea id="steps" name="steps" rows="3" placeholder="Étape 1&#10;Étape 2">{{ form.get('steps') if form else '' }}</textarea>
    </div>

    <div class="field full">
      <label for="data_needed">Entrées – données</label>
      <textarea id="data_needed" name="data_needed" rows="3">{{ form.get('data_needed') if form else '' }}</textarea>
    </div>

    <div class="field full">
      <label for="docs_needed">Entrées – documents de référence</label>
      <textarea id="docs_needed" name="docs_needed" rows="3">{{ form.get('docs_needed') if form else '' }}</textarea>
    </div>

    <div class="field full">
      <label for="tools_needed">Logiciels / outils</label>
      <textarea id="tools_needed" name="tools_needed" rows="2">{{ form.get('tools_needed') if form else '' }}</textarea>
    </div>

    <div class="field full">
      <label for="outputs">Sorties – livrables</label>
      <textarea id="outputs" name="outputs" rows="3">{{ form.get('outputs') if form else '' }}</textarea>
    </div>

    <div class="field">
      <label for="formats">Formats</label>
      <textarea id="formats" name="formats" rows="2">{{ form.get('formats') if form else '' }}</textarea>
    </div>

    <div class="field full">
      <label for="recipients">Destinataires / diffusion</label>
      <textarea id="recipients" name="recipients" rows="2">{{ form.get('recipients') if form else '' }}</textarea>
    </div>

    <div class="field full">
      <label for="pains">Points de douleur actuels</label>
      <textarea id="pains" name="pains" rows="3" placeholder="Manque de données à jour&#10;Re-saisie manuelle répétée">{{ form.get('pains') if form else '' }}</textarea>
    </div>

    <fieldset class="field-group">
      <legend>Pistes d'automatisation</legend>
      <div class="field full">
        <label for="automation_ideas">Idées / solutions</label>
        <textarea id="automation_ideas" name="automation_ideas" rows="3">{{ form.get('automation_ideas') if form else '' }}</textarea>
      </div>
      <div class="field">
        <label for="automation_type">Type</label>
        <input type="text" id="automation_type" name="automation_type" value="{{ form.get('automation_type') if form else '' }}">
      </div>
      <div class="field">
        <label for="automation_prereq">Pré-requis</label>
        <input type="text" id="automation_prereq" name="automation_prereq" value="{{ form.get('automation_prereq') if form else '' }}">
      </div>
      <div class="field">
        <label for="automation_effort">Niveau d'effort</label>
        <input type="text" id="automation_effort" name="automation_effort" value="{{ form.get('automation_effort') if form else '' }}">
      </div>
      <div class="field full">
        <label for="automation_benefits">Bénéfices attendus</label>
        <textarea id="automation_benefits" name="automation_benefits" rows="2">{{ form.get('automation_benefits') if form else '' }}</textarea>
      </div>
    </fieldset>

    <fieldset class="field-group">
      <legend>Priorisation</legend>
      <div class="field">
        <label for="priority">Priorité</label>
        <input type="text" id="priority" name="priority" placeholder="Haute / moyenne / basse" value="{{ form.get('priority') if form else '' }}">
      </div>
      <div class="field">
        <label for="status">Statut</label>
        <input type="text" id="status" name="status" value="{{ form.get('status') if form else '' }}">
      </div>
      <div class="field full">
        <label for="next_action">Prochaine action</label>
        <input type="text" id="next_action" name="next_action" value="{{ form.get('next_action') if form else '' }}">
      </div>
      <div class="field full">
        <label for="linked_docs">Documents liés</label>
        <textarea id="linked_docs" name="linked_docs" rows="2" placeholder="refs/...">{{ form.get('linked_docs') if form else '' }}</textarea>
      </div>
    </fieldset>

    <div class="actions">
      <button type="submit" class="button">Créer la fiche</button>
      <a class="button secondary" href="{{ url_for('home') }}">Annuler</a>
    </div>
  </form>
</section>
{% endblock %}
