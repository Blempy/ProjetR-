{% extends "base.html" %}

{% block title %}Nouveau point de douleur{% endblock %}

{% block content %}
<section class="card">
  <h2>Enregistrer un point de douleur</h2>
  <p>Chaque enregistrement est ajouté au tableau Markdown (<code>refs/points_douleur/&lt;phase&gt;.md</code>).</p>

  <form method="post" class="form-grid">
    <div class="field">
      <label for="phase">Phase concernée</label>
      <input type="text" id="phase" name="phase" list="phase-list" required value="{{ form.get('phase') if form else '' }}">
      <datalist id="phase-list">
        {% for phase in phase_options %}
          <option value="{{ phase }}">
        {% endfor %}
      </datalist>
    </div>

    <div class="field">
      <label for="task">Tâche ciblée</label>
      <input type="text" id="task" name="task" required value="{{ form.get('task') if form else '' }}">
    </div>

    <div class="field full">
      <label for="description">Description du problème</label>
      <textarea id="description" name="description" rows="3" required>{{ form.get('description') if form else '' }}</textarea>
    </div>

    {% macro score_select(name, label) -%}
      <div class="field">
        <label for="{{ name }}">{{ label }} (1-5)</label>
        <select id="{{ name }}" name="{{ name }}">
          {% for value in range(1, 6) %}
            <option value="{{ value }}" {% if form and form.get(name, '1')|int == value %}selected{% endif %}>{{ value }}</option>
          {% endfor %}
        </select>
      </div>
    {%- endmacro %}

    {{ score_select("frequency", "Fréquence") }}
    {{ score_select("duration", "Durée / charge") }}
    {{ score_select("impact", "Impact en cas d'erreur") }}
    {{ score_select("stress", "Stress / complexité") }}

    <div class="field full">
      <label for="automation_idea">Idée d'automatisation</label>
      <textarea id="automation_idea" name="automation_idea" rows="2" placeholder="Script de vérification, modèle de rapport...">{{ form.get('automation_idea') if form else '' }}</textarea>
    </div>

    <div class="field full">
      <label for="comments">Commentaires complémentaires</label>
      <textarea id="comments" name="comments" rows="2">{{ form.get('comments') if form else '' }}</textarea>
    </div>

    <div class="actions">
      <button type="submit" class="button">Enregistrer</button>
      <a class="button secondary" href="{{ url_for('home') }}">Annuler</a>
    </div>
  </form>
</section>
{% endblock %}
